# 坐标系与角度

## 坐标系

- **坐标系定义**

  游戏中实际使用的坐标系 X 正方向朝东➡️、Y 正方向朝南⬇️、Z 正方向朝上（高度），均为 `float` 浮点数。

  此坐标系的具体数据在游戏内不可见，但你可以通过日志、FFLogs、实体解析等各种方式获取到坐标数据。

  此坐标系与小地图的坐标轴方向一致，但坐标不同。比例尺一般为小地图 1 : 实际坐标 50，原点位置也并不一致。

  > **补充说明：**
  >
  > 如果你只是刚接触 FF14 的坐标系，你可以先忽略这段内容，记住图中的坐标系即可。
  > 
  > 这个定义和内存及网络包中的真实顺序不一样，真实的顺序是 X Z Y，即 Y 是高度轴、Z 是正南方向。
  >
  > FFXIV 解析插件将内存和网络包中的 YZ 定义颠倒并输出为日志，以匹配数学上的正常习惯，即 XOY 为水平面。
  > 
  > 后续 ACT 中的 OverlayPlugin、触发器等插件基本也都仿照此定义修改了顺序。
  > 
  > 这也带来了一些问题，无论平面还是三维坐标系都变成了左手系，且部分涉及到角度的数学函数可能与正常定义下有所出入。
  >
  > 你可能在一些插件（如鲶鱼精邮差、卫月）中看见 Y Z 与之相反的定义，届时需留意。


- **实际场地**

  4.0 时期，大多数形状规则的八人本场地的中心坐标是 `0, 0, 0`。

  5.0 以后，大多数新场地的中心坐标变为了 `100, 100, 0`，如下图所示。

  也有少数例外（如 P5s 被原型宝石兽踹到了 `100, 100, -300`）。

  场地的半径/半宽一般是 20，也有少数 15 （如高贝扎，M3s，一些矩形场地的短边）。

  你可以用触发器查询 `${_me.Pos}` 获取自身的三维坐标，  
  或使用 `${_entity[${_me.TargetID}].Pos}` 获取自己选中的实体（Boss）的坐标，  
  很容易判断出场地中心和半径/半宽。

下图以万魔殿 P6s 的场地为例，详细画出了坐标系（浅黄色）和面向（红色）的示意。

![coord](https://github.com/user-attachments/assets/1b8599cf-85f1-4fc7-94d2-d3f9511338bd)

## 面向

三个维度的坐标和一个水平旋转角（面向）构成了 FF14 中实体位姿的全部四个自由度，  
即你只使用这四个参数即可精确描述一个实体的位姿信息。

无论在日志中还是在游戏底层，旋转角均为弧度表示的 `float` 浮点数，  
范围从 `-π (-3.14)` 至 `π (3.14)`。

如上图，在俯视视角下，旋转角定义为从 `z` 正半轴方向（正南）开始旋转的角度，沿逆时针方向增加。

如正西为 `-π/2`，正南为 `0`，正东为 `π/2`，正北为 `±π`。

方向角的变化周期为 `2π`，在原本的数值上增减 `2π` 不会影响实际面向，  
你一般也无需将角度标准化至 `-π` 至 `π`。

为方便输入，触发器中的数学解析模块支持角度转为弧度，  
如在数值模式下输入的 `30°` 会计算为对应的弧度值 `0.5236`。

> **补充说明：**
>
> 这不涉及三维旋转。
>
> FF14 中的三维旋转通过四元数或矩阵定义和计算，仅和显示模型有关，实体并没有另外两个旋转自由度。

## 相关数学函数

触发器中定义了很多数学函数，以方便处理与坐标和方向角有关的数学计算。

...
