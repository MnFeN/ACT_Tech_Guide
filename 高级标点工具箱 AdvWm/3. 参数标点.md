# 3. 参数标点

参数标点是本工具箱的主要功能。

回调名称依旧为 `AdvWm`，回调参数为多行字符串，如：

```javascript
// 标点模式：
Action: Circle
Waymarks: A4D3C2B1
R: 10√2

// 修饰：
Scale: 2
Center: 100, 100, 0
θ: ${_me.Heading}

// 共通参数：
Log: true
Local: true
```

**执行这条具名回调动作时，程序会按照以下流程处理：**

## 预处理字符串

触发器首先会将文本中的所有 `${...}` 解析替换为实际值，然后将整段文本传入高级标点触发器。

如最后的 `${_me.Heading}` 会被触发器替换为自己的实际面向，如 `0.78`。

> [!TIP]
> 参数名、表达式都是字符串（文本），你可以充分发挥想象力拼接或处理字符串。

## 按行拆分

高级标点工具箱接收到指令后，会按行分割整段指令。

空白行、`//` 开头的注释行、未包含半角冒号 `:` 的行会被忽略；

其余行会视为一条参数 `name: value`。

如 `Center: 100, 100, 0` 这行会解析出参数名 `Center`、参数值 `100, 100, 0`。

> [!TIP]
> 参数对大小写不敏感；  
> 拆分字符串后会自动删除两侧空格；  
> 各参数的前后顺序不重要。  

## 确定模式

第一部分参数是与标点模式有关的特殊参数。

首先程序会尝试查找 `Action` 参数，它决定这个指令使用什么模式标点。

对于不同模式，需要传入的参数也不同。

如默认模式下，需要传入各个标点的相对坐标；  
圆周模式下，需要传入半径及要用到的标点等。

程序会根据给定的参数计算出一组**初始的相对坐标**。

关于不同模式的具体用法，详见后文介绍。

## 应用修饰

```javascript
Scale: 2
Center: 100, 100, 0
θ: ${_me.Heading}
```

**修饰**指的是上述三个线性变换操作：缩放、旋转、平移。

如果提供了修饰参数，上述的**初始相对坐标**会依次根据给定的缩放倍率缩放、给定的角度旋转、给定的中心坐标平移至最终位置。

程序会自动计算这些线性变换，并得出一组**最终坐标**。

关于三种修饰的具体用法，详见后文介绍。

## 标点行为

还有两个共通参数：`Log` 和 `Local`（亦可写作鲶鱼精邮差中的名称 `LocalOnly`）。

```javascript
Log: true
Local: true
```

传入 `bool` 参数时，也可以用数值，非 `0` 值会被视为 `true`，如 `Log: 1`。 

参数默认值均为 `true`，即默认会输出日志到鲶鱼精邮差；默认使用本地标点。

> [!TIP]
> 
> **`Local: false` 在战斗中无效。**
> 
> 本地标点可以达到几帧/次；而网络标点仅有约 1 秒/次。 
>
> 网络标点仅用于偶尔将一套标点公开给全队，如开战前标点。


